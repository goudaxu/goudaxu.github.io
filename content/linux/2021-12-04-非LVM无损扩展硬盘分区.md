+++
title =   "非LVM无损扩展硬盘分区(不推荐)"
date =   "2021-12-26"
[taxonomies] 
tags = ["linux"]
categories = ["linux"]
+++


 安装公司samba服务器时对磁盘需求量估计不足，原本分的只有100GB，使用一段时间后磁盘就达到了 86%的使用量，![使用resize2fs调整ext4分区大小 - 明天的阳光 - 明天的阳光](http://b.bst.126.net/common/portrait/face/preview/face15.gif)

我的情况  将一块硬盘分成了两个区，一个100GB 一个60GB  ，只使用了前100GB空间的内容，后面的分区没有挂载，也没有使用。属于比较好处理的情况

我的步骤：

1、umount 掉sdb磁盘    若提示磁盘忙的话请使用fuser  命令将正在使用磁盘的程序kill掉。 

fuser -k -x -u -c /dev/hd1 或者fuser -kxuc /home

2、使用 fdisk  /dev/sdb 命令调整分区大小   进去后先使用p命令查看磁柱号 ，切记用笔记下来 ~~~ 别说我没有提醒你哦。。

3、删除掉这你需要变化的分区和需要借用的分区（意思就是准备变大的分区及准备变小的分区）然后再使用n命令建立分区，注意开始的磁柱号要和原来的一致，结束的磁柱号可以是你期望的磁柱号。。不知道的就输入你想要的磁盘大小即可 如+150GB  

4、建立需要调整的分区（借用的）。

5、使用保存分区表。 

6、使用e2fsck  -f    /dev/sdb1     \\ 需要调整的分区  

```

```

[root@localhost 桌面]# e2fsck -f /dev/sdb1 e2fsck 1.41.12 (17-May-2010) 第一步: 检查inode,块,和大小 第二步: 检查目录结构 第3步: 检查目录连接性 Pass 4: Checking reference counts 第5步: 检查簇概要信息 /dev/sdb1: 5496/6111232 files (1.8% non-contiguous), 18781569/24416784 blocks

 7、最后再使用 resize2fs /dev/sdb1 调整分区大小。

```

```

[root@BIGDATA 桌面]# resize2fs /dev/sdb1 resize2fs 1.41.12 (17-May-2010) Resizing the filesystem on /dev/sdb1 to 36622167 (4k) blocks. The filesystem on /dev/sdb1 is now 36622167 blocks long.

8、再mount一个磁盘分区，看看是不是变大了呢 。





## 用resize2fs 扩展linux分区大小

 (2014-07-15 09:31:25)

| 标签： | 分类： [linux](http://blog.sina.com.cn/s/articlelist_2099389457_6_1.html) |
| ------ | ------------------------------------------------------------ |
|        |                                                              |

最近发现备份服务器的分区空间开始告警，需要扩充磁盘空间， 在存储中把卷扩大后， linux 系统中还不能马上识别， 因为没有用linux 的LVM 来管理磁盘， 所以只好用 fdisk 来扩充分区了。



用fdisk 先删除原有分区， 再重建分区， 起始cylinder 绝对不可以改，这样会破坏原分区的数据。



分区建好后， 就可以用e2fsck 先检查一下分区， 再用resize2fs 扩大就可以了。

root@SHZ-VM-001:/# fdisk /dev/sdb



WARNING: DOS-compatible mode is deprecated. It's strongly recommended to

​        switch off the mode (command 'c') and change display units to

​        sectors (command 'u').



Command (m for help): p



Disk /dev/sdb: 322.1 GB, 322122547200 bytes

255 heads, 63 sectors/track, 39162 cylinders

Units = cylinders of 16065 * 512 = 8225280 bytes

Sector size (logical/physical): 512 bytes / 512 bytes

I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk identifier: 0x76148198



   Device Boot      Start        End     Blocks   Id  System

/dev/sdb1             1      26108  209712478+  83  Linux



Command (m for help): m

Command action

   a  toggle a bootable flag

   b   edit bsd disklabel

   c  toggle the dos compatibility flag

   d  delete a partition

   l   list known partition types

   m  print this menu

   n   add a new partition

   o  create a new empty DOS partition table

   p  print the partition table

   q   quit without saving changes

   s  create a new empty Sun disklabel

   t  change a partition's system id

   u  change display/entry units

   v  verify the partition table

   w  write table to disk and exit

   x  extra functionality (experts only)



Command (m for help): d

Selected partition 1



Command (m for help): p



Disk /dev/sdb: 322.1 GB, 322122547200 bytes

255 heads, 63 sectors/track, 39162 cylinders

Units = cylinders of 16065 * 512 = 8225280 bytes

Sector size (logical/physical): 512 bytes / 512 bytes

I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk identifier: 0x76148198



   Device Boot      Start        End     Blocks   Id  System



Command (m for help): m

Command action

   a  toggle a bootable flag

   b   edit bsd disklabel

   c  toggle the dos compatibility flag

   d  delete a partition

   l   list known partition types

   m  print this menu

   n   add a new partition

   o  create a new empty DOS partition table

   p  print the partition table

   q   quit without saving changes

   s  create a new empty Sun disklabel

   t  change a partition's system id

   u  change display/entry units

   v  verify the partition table

   w  write table to disk and exit

   x  extra functionality (experts only)



Command (m for help): n

Command action

   e  extended

   p  primary partition (1-4)

p

Partition number (1-4):

Value out of range.

Partition number (1-4): 1

First cylinder (1-39162, default 1):

Using default value 1

Last cylinder, +cylinders or +size{K,M,G} (1-39162, default 39162):

Using default value 39162



Command (m for help): p



Disk /dev/sdb: 322.1 GB, 322122547200 bytes

255 heads, 63 sectors/track, 39162 cylinders

Units = cylinders of 16065 * 512 = 8225280 bytes

Sector size (logical/physical): 512 bytes / 512 bytes

I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk identifier: 0x76148198



   Device Boot      Start        End     Blocks   Id  System

/dev/sdb1             1      39162  314568733+  83  Linux



Command (m for help): w

The partition table has been altered!



Calling ioctl() to re-read partition table.

Syncing disks.

root@SHZ-VM-001:/#

root@SHZ-VM-001:/#

root@SHZ-VM-001:/#

root@SHZ-VM-001:/# resize2fs /dev/sdb1

resize2fs 1.41.11 (14-Mar-2010)

Please run 'e2fsck -f /dev/sdb1' first.



root@SHZ-VM-001:/# e2fsck -f /dev/sdb1

e2fsck 1.41.11 (14-Mar-2010)

Pass 1: Checking inodes, blocks, and sizes

Pass 2: Checking directory structure

Pass 3: Checking directory connectivity

Pass 4: Checking reference counts

Pass 5: Checking group summary information

/dev/sdb1: 474754/13107200 files (0.4% non-contiguous), 45135492/52428119 blocks

root@SHZ-VM-001:/# resize2fs /dev/sdb1

resize2fs 1.41.11 (14-Mar-2010)

Resizing the filesystem on /dev/sdb1 to 78642183 (4k) blocks.

The filesystem on /dev/sdb1 is now 78642183 blocks long.



root@SHZ-VM-001:/# mount /dev/sdb1 /lv_backup/

root@SHZ-VM-001:/# ls -l /lv_backup/

lost+found/   rsync_backup/

root@SHZ-VM-001:/# ls -l /lv_backup/rsync_backup/

total 24

drwxr-xr-x  6 root   root 4096 2014-07-14 15:26 dmz

drwxr-xr-x 60 nobody root 4096 2014-07-15 04:00 forge-router

drwxr-xr-x  4 nobody root 4096 2014-06-17 11:21 sz01003

drwxr-xr-x  2 nobody root 4096 2014-07-14 15:17 sz01006

drwxr-xr-x  4 nobody root 4096 2014-06-17 22:00 sz01007

drwxr-xr-x  5 nobody root 4096 2014-06-17 12:54 sz01009

root@SHZ-VM-001:/# df -h

Filesystem          Size  Used Avail Use% Mounted on

/dev/sda1            76G   15G   58G  21% /

none               1001M  172K 1001M   1% /dev

none               1005M    0 1005M   0% /dev/shm

none               1005M   60K 1005M   1% /var/run

none               1005M    0 1005M   0% /var/lock

none               1005M    0 1005M   0% /lib/init/rw

/dev/sdb1           296G  170G  112G  61% /lv_backup






